<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEDA ANALYTICS - Wellness Through Wisdom</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #4DB6AC 0%, #66BB6A 50%, #4CAF50 100%);
            min-height: 100vh;
            color: #333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Subtle background pattern for a premium look */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            pointer-events: none;
            z-index: 0;
        }
        
        .page {
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            max-width: 450px;
            margin: auto;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        .page.active {
            display: flex;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 40px;
            width: 100%;
        }
        
        .logo {
            font-size: 4rem;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
        }
        
        .medical-symbol {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            color: #4CAF50;
            text-shadow: 0 1px 5px rgba(0,0,0,0.5);
        }
        
        .app-name {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-size: 1.1rem;
            color: #ffffff;
            opacity: 0.9;
            font-style: italic;
            font-weight: 300;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4DB6AC, #66BB6A, #4CAF50);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-icon {
            font-size: 2.5rem;
            margin-right: 15px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            background: linear-gradient(135deg, #4DB6AC, #66BB6A);
            color: white;
            box-shadow: 0 5px 15px rgba(77, 182, 172, 0.4);
        }
        
        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2E7D75;
            margin-bottom: 5px;
        }
        
        .card-subtitle {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }
        
        .card-content {
            margin: 20px 0;
        }

        .button-group {
            margin-top: 20px;
        }
        
        .btn {
            width: 100%;
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn i {
            margin-right: 8px;
            font-size: 1.1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4DB6AC, #66BB6A);
            color: white;
        }
        
        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-disabled {
            background: #cccccc;
            color: #999999;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .btn-disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .btn-coming-soon {
            background: linear-gradient(135deg, #FF9800, #FF5722);
            color: white;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .upload-status {
            display: none;
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .upload-success {
            background: #E8F5E8;
            color: #2E7D32;
            border: 1px solid #4CAF50;
        }
        
        .upload-error {
            background: #FFEBEE;
            color: #C62828;
            border: 1px solid #F44336;
        }
        
        .file-input {
            display: none;
        }

        /* Analysis Page Styles */
        .disclaimer {
            background: #fff8e1;
            color: #ffa000;
            padding: 15px;
            border-radius: 12px;
            font-size: 0.9em;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid #ffcc80;
        }

        .tabs-container {
            background: #f0f0f0;
            border-radius: 12px;
            padding: 5px;
            display: flex;
            width: 100%;
            margin-bottom: 20px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: none;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #4DB6AC, #66BB6A);
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            transform: translateY(-2px);
            z-index: 2;
        }

        .tab-btn i {
            margin-right: 8px;
        }

        .analysis-content {
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .analysis-section-title {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: #2E7D75;
            margin-bottom: 20px;
        }

        .analysis-section-title i {
            margin-right: 10px;
        }

        .parameter-card {
            background: #f8f8f8;
            border-left: 5px solid;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }

        .parameter-title {
            display: flex;
            align-items: center;
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 5px;
            color: #444;
        }

        .parameter-title i {
            margin-right: 8px;
            font-size: 1.2em;
        }

        .status-badge {
            font-size: 0.8em;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 10px;
            color: white;
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .status-red { background: #f44336; }
        .status-orange { background: #ff9800; }
        .status-green { background: #4caf50; }

        .analysis-detail {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 5px;
            line-height: 1.5;
        }
        
        .ayurvedic-list {
            list-style-type: none;
            padding-left: 0;
            margin-left: 0;
        }

        .ayurvedic-list li {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            line-height: 1.5;
        }
        
        .ayurvedic-list i {
            margin-right: 10px;
            margin-top: 4px;
            color: #2E7D75;
            font-size: 1.2em;
        }
        
        .placeholder-text {
            color: #999;
            font-style: italic;
            text-align: center;
            margin-top: 20px;
        }
        
        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-top: 50px;
        }

        .loader i {
            font-size: 3em;
            color: #4DB6AC;
            animation: spin 2s linear infinite;
        }
        
        .loader p {
            margin-top: 10px;
            font-size: 1em;
            color: #666;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 400px;
        }
        
        .modal-content h3 { margin-bottom: 10px; font-size: 1.2rem; color: #333; }
        .modal-content p { margin-bottom: 20px; color: #666; }
        .modal-content button {
            background-color: #4DB6AC;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .modal-content button:hover { background-color: #38a193; }

        @media (max-width: 480px) {
            .page { padding: 10px; }
            .card { padding: 25px 20px; }
            .app-name { font-size: 2rem; }
            .card-icon { font-size: 2rem; width: 50px; height: 50px; }
            .card-title { font-size: 1.2rem; }
            .disclaimer { font-size: 0.8em; }
        }
    </style>
</head>
<body>
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle"></h3>
            <p id="modalMessage"></p>
            <button id="modalClose">OK</button>
        </div>
    </div>
    
    <div id="homePage" class="page active">
        <div class="header">
            <div class="logo">
                <span class="lotus-icon">??</span>
                <span class="medical-symbol">??</span>
            </div>
            <h1 class="app-name">VEDA ANALYTICS</h1>
            <p class="tagline">Wellness Through Wisdom</p>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-tint"></i>
                </div>
                <div>
                    <h2 class="card-title">Blood Report Analyzer</h2>
                    <p class="card-subtitle">Modern medical analysis<br>AI-powered diagnostics</p>
                </div>
            </div>
            <div class="card-content">
                <div class="button-group">
                    <input type="file" id="fileInput" class="file-input" accept=".pdf,.jpg,.jpeg,.png" />
                    <button class="btn btn-primary" id="uploadBtn" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Upload Report
                    </button>
                    <div class="upload-status" id="uploadStatus"></div>
                    <button class="btn btn-disabled" id="analyzeBtn" disabled>
                        <i class="fas fa-search"></i>
                        Analyze
                    </button>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <div>
                    <h2 class="card-title">Ayurvedic Wisdom</h2>
                    <p class="card-subtitle">Traditional healing insights<br>Dosha-based recommendations</p>
                </div>
            </div>
            <div class="card-content">
                <div class="button-group">
                    <button class="btn btn-coming-soon">
                        <i class="fas fa-seedling"></i>
                        Get Suggestions (Coming Soon)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="analysisPage" class="page">
        <div class="disclaimer">
            This analysis is for educational purposes only. Always consult qualified healthcare providers for medical decisions. Ayurvedic recommendations are complementary to, not replacement for, medical treatment.
        </div>
        
        <div class="analysis-content">
            <div class="analysis-section-title">
                <i class="fas fa-file-medical-alt"></i> Report Analysis
            </div>
            <div class="tabs-container">
                <button id="tab1Btn" class="tab-btn active"><i class="fas fa-stethoscope"></i> Medical</button>
                <button id="tab2Btn" class="tab-btn"><i class="fas fa-mortar-pestle"></i> Ayurvedic</button>
            </div>

            <div id="medicalContent">
                <div class="analysis-section-title">
                    <i class="fas fa-notes-medical"></i> Clinical Insights
                </div>
                <div id="medicalResults">
                    <div class="placeholder-text">Upload a report to see your medical analysis here.</div>
                </div>
            </div>

            <div id="ayurvedicContent" style="display:none;">
                <div class="analysis-section-title">
                    <i class="fas fa-seedling"></i> Traditional Healing
                </div>
                <div id="ayurvedicResults">
                    <div class="placeholder-text">Ayurvedic recommendations will appear here after analysis.</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ? CORRECTED API URL: Points to your live Vercel backend's /analyze endpoint.
        const API_URL = 'https://veda-analytics-backend.vercel.app/analyze'; 
        
        const homePage = document.getElementById('homePage');
        const analysisPage = document.getElementById('analysisPage');
        const uploadBtn = document.getElementById('uploadBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const fileInput = document.getElementById('fileInput');
        const uploadStatus = document.getElementById('uploadStatus');
        const tab1Btn = document.getElementById('tab1Btn');
        const tab2Btn = document.getElementById('tab2Btn');
        const medicalContent = document.getElementById('medicalContent');
        const ayurvedicContent = document.getElementById('ayurvedicContent');
        const medicalResults = document.getElementById('medicalResults');
        const ayurvedicResults = document.getElementById('ayurvedicResults');
        
        const messageModal = document.getElementById('messageModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const modalClose = document.getElementById('modalClose');

        function showMessage(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            messageModal.style.display = 'flex';
        }

        modalClose.onclick = function() {
            messageModal.style.display = 'none';
        }

        let currentReportData = null;

        function showPage(pageId) {
            homePage.classList.remove('active');
            analysisPage.classList.remove('active');
            if (pageId === 'home') {
                homePage.classList.add('active');
            } else if (pageId === 'analysis') {
                analysisPage.classList.add('active');
            }
        }

        tab1Btn.addEventListener('click', () => {
            tab1Btn.classList.add('active');
            tab2Btn.classList.remove('active');
            medicalContent.style.display = 'block';
            ayurvedicContent.style.display = 'none';
        });

        tab2Btn.addEventListener('click', async () => {
            tab2Btn.classList.add('active');
            tab1Btn.classList.remove('active');
            medicalContent.style.display = 'none';
            ayurvedicContent.style.display = 'block';
        });

        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) {
                return;
            }

            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
            uploadBtn.classList.add('btn-loading');
            uploadStatus.style.display = 'block';
            uploadStatus.className = 'upload-status';
            uploadStatus.textContent = 'Uploading and analyzing report...';
            analyzeBtn.disabled = true;
            
            try {
                // Call the new callGeminiApi function which talks to the Vercel backend
                const data = await callGeminiApi(file);
                currentReportData = data;

                uploadBtn.innerHTML = '<i class="fas fa-check"></i> Report Ready';
                uploadBtn.classList.remove('btn-loading');
                uploadStatus.className = 'upload-status upload-success';
                uploadStatus.textContent = `? ${file.name} analyzed successfully`;
                analyzeBtn.disabled = false;
                analyzeBtn.className = 'btn btn-primary';

            } catch (error) {
                console.error('Error during file upload:', error);
                uploadBtn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Upload Report';
                uploadBtn.classList.remove('btn-loading');
                uploadStatus.className = 'upload-status upload-error';
                uploadStatus.textContent = `? Analysis failed. Error: ${error.message.substring(0, 50)}...`;
                analyzeBtn.disabled = true;
                analyzeBtn.className = 'btn btn-disabled';
                showMessage('Error', `Analysis failed. Please try a different report or check the console for details.`);
            }
        });

        analyzeBtn.addEventListener('click', () => {
            if (currentReportData) {
                updateAnalysisPage(currentReportData);
                showPage('analysis');
            } else {
                showMessage('Error', 'Please upload and process a report first.');
            }
        });

        // ??? CORRECTED callGeminiApi to use FormData and talk to the Vercel backend
        async function callGeminiApi(file) {
            const formData = new FormData();
            
            // 'report' matches upload.single('report') in api/index.js
            formData.append('report', file); 

            const response = await fetch(API_URL, {
                method: 'POST',
                // Do NOT set Content-Type; the browser sets it correctly for FormData
                body: formData
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                // Throw an error with the response status and message from the server
                throw new Error(`API Error ${response.status}: ${errorText}`);
            }
            
            // The Vercel backend returns the final JSON data directly
            const result = await response.json();
            return result;
        }
        
        async function updateAnalysisPage(data) {
            medicalResults.innerHTML = '';
            ayurvedicResults.innerHTML = '';
            
            const medicalAnalysis = {
                'HbA1c': { unit: '%', range: '<5.7%', status: 'Normal', color: 'green' },
                'Total Cholesterol': { unit: 'mg/dL', range: '<200 mg/dL', status: 'Optimal', color: 'green' },
                'HDL Cholesterol': { unit: 'mg/dL', range: '=50 mg/dL (Women)', status: 'Normal', color: 'green' },
                'Triglycerides': { unit: 'mg/dL', range: '<150 mg/dL', status: 'Normal', color: 'green' },
                'Uric Acid': { unit: 'mg/dL', range: '2.4-6.0 mg/dL (Women)', status: 'Normal', color: 'green' },
                'Creatinine': { unit: 'mg/dL', range: '0.6-1.1 mg/dL (Women)', status: 'Normal', color: 'green' },
                'Hemoglobin': { unit: 'g/dL', range: '12.1-15.1 g/dL (Women)', status: 'Normal', color: 'green' },
                'TSH': { unit: 'mIU/L', range: '0.4-4.5 mIU/L', status: 'Normal', color: 'green' }
            };

            for (const param in data) {
                const value = data[param];
                const analysis = medicalAnalysis[param];

                if (value !== null && analysis) {
                    let status = analysis.status;
                    let color = analysis.color;
                    let risk = null;
                    let alert = null;
                    const valueFloat = parseFloat(value);

                    if (param === 'HbA1c') {
                        if (valueFloat >= 6.5) { status = 'DIABETIC'; color = 'red'; risk = 'Significantly increased risk of heart disease.'; alert = 'Consult a healthcare provider.'; }
                        else if (valueFloat >= 5.7) { status = 'PREDIABETIC'; color = 'orange'; risk = 'Increased risk of developing Type 2 diabetes.'; alert = 'Dietary and lifestyle changes are recommended.'; }
                    } else if (param === 'Total Cholesterol') {
                        if (valueFloat >= 240) { status = 'HIGH'; color = 'red'; risk = 'Significantly increased risk of heart disease and stroke.'; alert = 'Medical consultation is highly recommended.'; }
                        else if (valueFloat >= 200) { status = 'BORDERLINE'; color = 'orange'; risk = 'Increased risk of heart disease. Requires monitoring.'; alert = 'Lifestyle changes are recommended.'; }
                    } else if (param === 'HDL Cholesterol') {
                        if (valueFloat < 50) { status = 'LOW'; color = 'red'; risk = 'Increased risk of heart disease. Requires medical evaluation.'; alert = 'Consult a healthcare provider for a detailed lipid panel and advice.'; }
                    } else if (param === 'Triglycerides') {
                        if (valueFloat >= 200) { status = 'HIGH'; color = 'red'; risk = 'Increased risk of heart disease and metabolic syndrome.'; alert = 'Medical follow-up is necessary to manage this condition.'; }
                        else if (valueFloat >= 150) { status = 'BORDERLINE'; color = 'orange'; risk = 'Requires monitoring. Risk of heart disease may increase.'; alert = 'Lifestyle changes are recommended.'; }
                    } else if (param === 'Uric Acid') {
                        if (valueFloat > 6.0) { status = 'HIGH'; color = 'red'; risk = 'Increased risk of gout and kidney stones.'; alert = 'Medical consultation and dietary changes are advised.'; }
                    } else if (param === 'TSH') {
                        if (valueFloat < 0.4) { status = 'LOW'; color = 'red'; risk = 'May indicate hyperthyroidism. Requires further evaluation.'; alert = 'Consult a healthcare provider for a thyroid panel.'; }
                        else if (valueFloat > 4.5) { status = 'HIGH'; color = 'red'; risk = 'May indicate hypothyroidism. Requires further evaluation.'; alert = 'Consult a healthcare provider for a thyroid panel.'; }
                    }

                    // Only show abnormal results or all results if no abnormalities found
                    const isAbnormal = status && status !== 'Normal' && status !== 'Optimal';
                    
                    if (isAbnormal) {
                        const paramCard = `
                            <div class="parameter-card" style="border-left-color: ${color}">
                                <div class="parameter-title">
                                    <i class="fas fa-square-full" style="color:${color}"></i> ${param}
                                    <span class="status-badge status-${color}">${status}</span>
                                </div>
                                <p class="analysis-detail">Value: ${value} ${analysis.unit || ''}</p>
                                <p class="analysis-detail">Normal Range: ${analysis.range}</p>
                                <p class="analysis-detail">Your Status: Your value is in the ${status.toLowerCase()} range.</p>
                                <p class="analysis-detail">Risk Level: ${risk}</p>
                            </div>
                        `;
                        medicalResults.innerHTML += paramCard;
                    }
                }
            }

            if (medicalResults.innerHTML === '') {
                medicalResults.innerHTML = '<div class="placeholder-text">All key parameters are within the normal range. Great job!</div>';
            }
            
            // Generate Ayurvedic Recommendations (The full logic is here)
            const ayurvedicRecommendations = {
                'HbA1c': {
                    view: 'Ayurveda views high blood sugar as a imbalance of Kapha and Vata doshas, often caused by poor digestion (Agni) and accumulation of toxins (Ama). This can be linked to sedentary lifestyle and excessive intake of sweet and heavy foods.',
                    diet: ['Avoid: Excessive sweets, refined carbohydrates, dairy products, and starchy foods like potatoes and bananas.', 'Include: Bitter and pungent foods such as karela (bitter gourd), methi (fenugreek), and leafy greens. Incorporate whole grains and legumes.'],
                    lifestyle: ['Yoga: Asanas like Surya Namaskar, Paschimottanasana, and Ardha Matsyendrasana to stimulate the pancreas and improve circulation.', 'Pranayama: Kapalabhati (skull-shining breath) and Bhastrika (bellows breath) to increase metabolic fire.', 'Exercise: Daily brisk walking or light jogging for at least 30 minutes.', 'Daily Routine: Establish a regular routine for meals and sleep. Avoid napping during the day.'],
                },
                'Total Cholesterol': {
                    view: 'High cholesterol is seen as a Kapha imbalance, where sluggish digestion leads to the build-up of fats and toxins (Ama) in the body. This blocks the channels (Shrotas) and impairs circulation.',
                    diet: ['Avoid: Fried foods, cheese, red meat, and processed foods.', 'Include: High-fiber foods like oats and apples. Use spices like turmeric, ginger, and garlic, which are known to improve digestion and metabolism.'],
                    lifestyle: ['Yoga: Twisting poses like Ardha Matsyendrasana to stimulate the liver and digestive fire.', 'Pranayama: Bhastrika and Surya Bhedana (sun-piercing breath) to increase body heat and metabolism.', 'Exercise: Vigorous activities like running or cycling to burn excess Kapha.', 'Daily Routine: Wake up early and start the day with a glass of warm water with lemon to cleanse the system.'],
                },
                'Triglycerides': {
                    view: 'High triglycerides are a symptom of deep-seated Kapha imbalance. This is often linked to a diet high in sugars and fats, which creates an environment where fat is easily stored and not utilized.',
                    diet: ['Avoid: All forms of refined sugars, alcohol, and excessive fruit intake.', 'Include: Lean proteins, legumes, and vegetables. Use spices like cumin, coriander, and black pepper to improve digestion.'],
                    lifestyle: ['Yoga: Vinyasa flows and poses that focus on core strength and metabolism.', 'Pranayama: Agnisara Kriya to activate the digestive fire.', 'Exercise: High-intensity interval training (HIIT) to improve fat metabolism.', 'Daily Routine: Eat the main meal at midday when the digestive fire is strongest. Avoid snacking between meals.'],
                },
                'Uric Acid': {
                    view: 'High uric acid is often seen as a Vata-Pitta imbalance, leading to impaired metabolism of certain proteins and the accumulation of toxins in the joints and tissues. This is linked to a hot, acidic constitution.',
                    diet: ['Avoid: Red meat, seafood, and alcohol.', 'Include: Pungent, bitter, and astringent foods such as fresh vegetables, grains, and legumes. Drink plenty of water.'],
                    lifestyle: ['Yoga: Gentle, cooling poses like Baddha Konasana (Bound Angle Pose).', 'Pranayama: Sitali (cooling breath) and Sitkari (hissing breath) to calm the Pitta dosha.', 'Exercise: Gentle, consistent activities like walking or swimming.', 'Daily Routine: Incorporate cooling foods and drinks into your diet. Avoid spicy and fermented foods.'],
                },
            };
            
            let hasAyurvedicRecommendations = false;
            
            for (const param in data) {
                const value = data[param];
                const recommendations = ayurvedicRecommendations[param];
                
                // Only provide recommendations if the value is abnormal based on our medical rules
                const medicalAnalysisEntry = medicalAnalysis[param];
                const isAbnormal = medicalAnalysisEntry && value !== null && 
                    ((param === 'HbA1c' && parseFloat(value) >= 5.7) ||
                    (param === 'Total Cholesterol' && parseFloat(value) >= 200) ||
                    (param === 'HDL Cholesterol' && parseFloat(value) < 50) ||
                    (param === 'Triglycerides' && parseFloat(value) >= 150) ||
                    (param === 'Uric Acid' && parseFloat(value) > 6.0) ||
                    (param === 'TSH' && (parseFloat(value) < 0.4 || parseFloat(value) > 4.5)));
                
                if (isAbnormal && recommendations) {
                    hasAyurvedicRecommendations = true;
                    const ayurvedicCard = `
                        <div class="analysis-section-title">
                            <i class="fas fa-herbal"></i> RECOMMENDATIONS FOR ${param.toUpperCase()} (${value})
                        </div>
                        <p class="analysis-detail"><b>Ayurvedic View:</b> ${recommendations.view}</p>
                        <h4 class="analysis-section-title"><i class="fas fa-leaf"></i> DIETARY GUIDANCE</h4>
                        <ul class="ayurvedic-list">
                            ${recommendations.diet.map(item => `<li><i class="fas fa-check"></i> ${item}</li>`).join('')}
                        </ul>
                        <h4 class="analysis-section-title"><i class="fas fa-universal-access"></i> LIFESTYLE MODIFICATIONS</h4>
                        <ul class="ayurvedic-list">
                            ${recommendations.lifestyle.map(item => `<li><i class="fas fa-check"></i> ${item}</li>`).join('')}
                        </ul>
                    `;
                    ayurvedicResults.innerHTML += ayurvedicCard;
                }
            }
            if (!hasAyurvedicRecommendations) {
                ayurvedicResults.innerHTML = '<div class="placeholder-text">Based on your report, all key values are within ranges that require no immediate Ayurvedic lifestyle corrections.</div>';
            }
        }
    </script>
</body>
</html>